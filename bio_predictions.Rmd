---
title: "Biology Predictions"
author: "Jenny Rogers"
date: "April 30, 2020"
output: html_document
---

```{r}

library(tidyverse)
library(sf)
library(lubridate)

```

In this document, we make predictions for the biology using the stream temp and the hydrologic metrics and the already built biological models.

In this first code chunk, we read in the random forest models for each spp to predict P(occurrence) based on streamflow, the logistic regession models based on temperature, and the streamflow metric and temperature dataframes

```{r}
#models based on streamflow metrics
load("mod_chub_rf.RData")
load("mod_vireo_rf.RData")
load("mod_toad_rf.RData")
load("mod_turtle_rf.RData")
load("mod_sucker_rf.RData")
load("mod_trout_rf.RData")

#models based on temp metrics

#streamflow metric and temp data

clusters<- st_read("C:/Users/JennyT/Documents/LitReview/RB4/StreamCat/COMID clustering.shp") %>% 
  data.frame() %>% 
  select(COMID, clstrCt, dam) %>% 
  filter(clstrCt == 1 & dam == 0 )

load("elv_comid.RData")

#baseline flow
load("bsflowmetest.RData")
baseline <- bsflowmetest %>% 
  select(var, COMID, dtsl, est) %>% 
  filter(COMID %in% clusters$COMID) %>% 
  mutate(year = year(dtsl)) %>% 
  spread(var, est)

#future flow
load("flowmetdt2.RData")
future <- flowmetdt2 %>% 
  select(var, COMID, dtsl, est) %>% 
  filter(COMID %in% clusters$COMID) %>% 
  mutate(year = year(dtsl)) %>% 
  spread(var, est)

flow <- bind_rows(baseline, future)
flow <- left_join(flow, elv, by = "COMID")

rm(bsflowmetest, flowmetdt2, clusters, baseline, future, elv)

load("tmp_metrics_all.RData")
```